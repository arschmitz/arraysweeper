!function(a,b){"function"==typeof define&&define.amd?define([],b):"object"==typeof exports?module.exports=b():a.Arraysweeper=b()}(this,function(){for(var a=function(a,b,c){this.height=a,this.width=b,this.count={mines:c,hidden:b*a,moves:0,revealed:0,flags:0},this._buildBoard()},b={mineCount:function(a,b){return"revealed"===this._board[a][b].state?this._board[a][b].count:"Reveal space to see count"},flag:function(a,b,c){return void 0===c?"flag"===this._board[a][b].state:(this.count.flags=this.count.flags+(c?1:-1),this.count.hidden=this.count.hidden-(c?1:-1),this._board[a][b].state=c?"flag":"hidden",console.log(this.count.hidden),this.count.flags+this.count.hidden===this.count.mines?"You Win!":void 0)},reveal:function(a,b){var c,d,e=this._board[a][b];return e.bomb&&0!==this.count.moves?"Game Over!":(e.bomb?this._buildBoard():this.count.flags+this.count.hidden===this.count.mines&&(c="You Win!"),this.count.moves++,d=this._reveal(a,b),c||d)},render:function(){for(var a=[],b=0;b<this.height;b++)a.push(JSON.stringify(this._board[b].map(this._renderMap)));console.log(a.join(",\n"))},getBoard:function(){return this._board},_renderMap:function(a){return"revealed"===a.state?a.count.toString():"flag"===a.state?"!":"X"},_getMines:function(){this.mines=[];for(var a=0;a<this.count.mines;a++){for(var b,c=!1;c===!1;){var d=this._getMine();-1===this.mines.indexOf(d.row+","+d.col)&&(b=d,c=!0)}this.mines.push(b.row+","+b.col)}},_getMine:function(){return{row:Math.floor(Math.random()*(this.height-1)),col:Math.floor(Math.random()*(this.width-1))}},_reveal:function(a,b,c,d){d=d||0,c="object"==typeof c?c:[],this._board[a][b].state="revealed",this.count.revealed++,this.count.hidden--;for(var e=a-1>0?a-1:0;a+1>=e&&e<this.width;e++)for(var f=b-1>0?b-1:0;b+1>=f&&f<this.width;f++)e>=0&&f>=0&&e<this.height&&f<this.width&&0===this._board[e][f].count&&"revealed"!==this._board[e][f].state&&!this._board[e][f].bomb&&-1===c.indexOf(e+","+f)&&(e!==a||f!==b)&&(this._board[e][f].state="",c.push(e+","+f));if(c.length&&c.length>=d+1){var g=c[d].split(",");this._reveal(parseFloat(g[0],10),parseFloat(g[1],10),c,d+1)}return c},_count:function(a,b){for(var c=0,d=a-1;a+1>=d;d++)for(var e=b-1;b+1>=e;e++)-1!==this.mines.indexOf(d+","+e)&&c++;return c},_buildBoard:function(){var a=[];this._getMines();for(var b=0;b<this.height;b++){for(var c=[],d=0;d<this.width;d++)c.push({state:"hidden",bomb:this.mines.indexOf(b+","+d)>=0,count:this._count(b,d)});a.push(c)}this._board=a}},c=Object.keys(b),d=0;d<c.length;d++)a.prototype[c[d]]=b[c[d]];return a});